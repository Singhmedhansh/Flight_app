<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Boarding Pass - {{ booking.airline_name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .boarding-pass-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .dashed-line {
            position: relative;
            border-top: 2px dashed #cbd5e1;
            margin: 24px 0;
        }
        .ticket-hole {
            position: absolute;
            width: 24px;
            height: 24px;
            background: #0f172a;
            border-radius: 50%;
            top: -13px;
        }
        .ticket-hole.left {
            left: -12px;
        }
        .ticket-hole.right {
            right: -12px;
        }
        .confirmed-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            transform: rotate(12deg);
            font-size: 3.5rem;
            font-weight: 900;
            color: rgba(34, 197, 94, 0.15);
            pointer-events: none;
            letter-spacing: 2px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Success Alert -->
        <div class="mb-8 p-6 rounded-xl bg-green-100 border border-green-400 text-green-800 flex items-center gap-4">
            <i class="fas fa-check-circle text-3xl"></i>
            <div>
                <h2 class="font-bold text-lg">Booking Confirmed!</h2>
                <p class="text-sm">Your digital ticket is ready. Check your email for a copy.</p>
            </div>
        </div>

        <!-- Main Boarding Pass Ticket -->
        <div class="boarding-pass-container rounded-2xl overflow-hidden border-4 border-slate-900">
            <div class="confirmed-badge">CONFIRMED</div>
            
            <!-- Ticket Content -->
            <div class="p-12">
                <!-- Header with Airline Info -->
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center gap-4">
                        <img src="https://logo.clearbit.com/{{ booking.airline_name.lower().replace(' ', '') }}.com" 
                             alt="{{ booking.airline_name }}" 
                             class="w-20 h-20 rounded-lg bg-slate-100 p-2 border border-slate-200"
                             onerror="this.src='https://via.placeholder.com/80?text={{ booking.airline_code }}'">
                        <div>
                            <h1 class="text-3xl font-bold text-slate-900">{{ booking.airline_name }}</h1>
                            <p class="text-slate-600 text-lg">Flight {{ booking.flight_number }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-slate-600 text-sm mb-1">Booking Reference</p>
                        <p class="text-slate-900 text-2xl font-bold font-mono">{{ booking.booking_reference }}</p>
                    </div>
                </div>

                <!-- Passenger Section -->
                <div class="bg-slate-50 rounded-xl p-6 mb-8">
                    <p class="text-slate-600 text-sm mb-2">Passenger Name</p>
                    <p class="text-slate-900 text-xl font-semibold">{{ session.get('username', 'Guest Passenger') | upper }}</p>
                </div>

                <!-- Route and Flight Details -->
                <div class="grid grid-cols-3 gap-8 mb-8 items-center">
                    <!-- Departure -->
                    <div>
                        <p class="text-slate-600 text-xs font-semibold mb-1 uppercase">From</p>
                        <p class="text-slate-900 text-4xl font-bold mb-2">{{ booking.origin }}</p>
                        <p class="text-slate-700 font-medium">{{ booking.origin_city }}</p>
                        <div class="mt-4 pt-4 border-t border-slate-200">
                            <p class="text-slate-600 text-xs mb-1">Departure</p>
                            <p class="text-slate-900 font-bold">
                                {% if booking.dep_time %}
                                    {{ booking.dep_time.split('T')[1][:5] if booking.dep_time is string and 'T' in booking.dep_time else booking.dep_time }}
                                {% endif %}
                            </p>
                            <p class="text-slate-600 text-xs">
                                {% if booking.dep_time %}
                                    {{ booking.dep_time.split('T')[0] if booking.dep_time is string and 'T' in booking.dep_time else '' }}
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <!-- Flight Details in Center -->
                    <div class="flex flex-col items-center">
                        {% if booking.stops == 0 %}
                            <span class="text-emerald-600 text-xs font-bold mb-4 uppercase">Non-stop</span>
                        {% else %}
                            <span class="text-amber-600 text-xs font-bold mb-4 uppercase">{{ booking.stops }} Stop{{ 's' if booking.stops > 1 else '' }}</span>
                        {% endif %}
                        <div class="relative w-full mb-4">
                            <div class="h-1 bg-slate-300 w-full"></div>
                            <i class="fas fa-plane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-slate-700 text-xl bg-white px-2"></i>
                        </div>
                        <p class="text-slate-600 text-xs font-semibold">{{ booking.duration }}</p>
                    </div>

                    <!-- Arrival -->
                    <div>
                        <p class="text-slate-600 text-xs font-semibold mb-1 uppercase">To</p>
                        <p class="text-slate-900 text-4xl font-bold mb-2">{{ booking.destination }}</p>
                        <p class="text-slate-700 font-medium">{{ booking.dest_city }}</p>
                        <div class="mt-4 pt-4 border-t border-slate-200">
                            <p class="text-slate-600 text-xs mb-1">Arrival</p>
                            <p class="text-slate-900 font-bold">
                                {% if booking.arr_time %}
                                    {{ booking.arr_time.split('T')[1][:5] if booking.arr_time is string and 'T' in booking.arr_time else booking.arr_time }}
                                {% endif %}
                            </p>
                            <p class="text-slate-600 text-xs">
                                {% if booking.arr_time %}
                                    {{ booking.arr_time.split('T')[0] if booking.arr_time is string and 'T' in booking.arr_time else '' }}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Dashed Separator with Holes -->
                <div class="dashed-line">
                    <div class="ticket-hole left"></div>
                    <div class="ticket-hole right"></div>
                </div>

                <!-- Seat and Details Section -->
                <div class="grid grid-cols-2 gap-8 mb-8">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <p class="text-slate-600 text-xs font-semibold mb-2 uppercase">Seat</p>
                            <p class="text-slate-900 text-3xl font-bold">{{ booking.seat_number }}</p>
                            <p class="text-slate-600 text-xs mt-1">Economy</p>
                        </div>
                        <div>
                            <p class="text-slate-600 text-xs font-semibold mb-2 uppercase">Price</p>
                            <p class="text-slate-900 text-3xl font-bold">${{ booking.price }}</p>
                        </div>
                    </div>

                    <!-- QR Code -->
                    <div class="flex flex-col items-center justify-center">
                        <p class="text-slate-600 text-xs font-semibold mb-3 uppercase">Mobile Boarding Pass</p>
                        <div id="qrcode" class="bg-white p-3 rounded-lg border border-slate-200"></div>
                        <p class="text-slate-600 text-xs mt-3">Scan at check-in</p>
                    </div>
                </div>

                <!-- Footer Info -->
                <div class="bg-slate-100 rounded-xl p-4 text-center mb-6">
                    <p class="text-slate-700 text-sm font-semibold mb-2">Check-in Opens 24 Hours Before Departure</p>
                    <p class="text-slate-600 text-xs">Please arrive at the airport 2 hours before departure. Have your passport ready.</p>
                </div>

                <!-- Barcode (mock) -->
                <div class="text-center py-4 border-t border-slate-200">
                    <p class="text-slate-600 text-xs mb-2 font-mono">{{ booking.booking_reference }}</p>
                    <div class="flex items-center justify-center gap-1 h-12">
                        {% for i in range(12) %}
                            {% if i % 2 == 0 %}
                                <div class="bg-slate-900 h-full" style="width: {{ [2, 3, 4]|random }}px;"></div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 grid grid-cols-2 gap-4">
            <button onclick="window.print()" class="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-xl transition-all">
                <i class="fas fa-print"></i>
                Print Ticket
            </button>
            <a href="{{ url_for('reservations') }}" class="flex items-center justify-center gap-2 bg-slate-900 hover:bg-slate-800 text-white font-semibold py-4 px-6 rounded-xl transition-all">
                <i class="fas fa-list"></i>
                View All Bookings
            </a>
        </div>

        <!-- Additional Options -->
        <div class="mt-8 bg-slate-100 rounded-xl p-6 text-center">
            <p class="text-slate-700 font-semibold mb-4">Need Help?</p>
            <div class="flex flex-wrap gap-4 justify-center text-sm">
                <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">Modify Booking</a>
                <span class="text-slate-400">•</span>
                <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">Add Luggage</a>
                <span class="text-slate-400">•</span>
                <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">Seat Upgrade</a>
                <span class="text-slate-400">•</span>
                <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">Cancel Booking</a>
            </div>
        </div>
    </div>

    <script>
        // Generate QR Code
        const qrText = "{{ booking.booking_reference }}-{{ booking.origin }}-{{ booking.destination }}-{{ booking.seat_number }}";
        new QRCode(document.getElementById("qrcode"), {
            text: qrText,
            width: 150,
            height: 150,
            colorDark: "#0f172a",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });
    </script>
</body>
</html>
