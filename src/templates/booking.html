<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Your Seat - {{ airline_name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .seat {
            transition: all 0.3s ease;
        }
        .seat:hover:not(.blocked):not(.selected) {
            transform: scale(1.15);
            cursor: pointer;
        }
        .seat.available {
            background: #10b981;
        }
        .seat.blocked {
            background: #6b7280;
            cursor: not-allowed;
            opacity: 0.5;
        }
        .seat.selected {
            background: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-950 to-slate-900 min-h-screen p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Back Button -->
        <a href="/dashboard" class="inline-flex items-center text-slate-300 hover:text-white mb-6 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            <span class="font-medium">Back to Search</span>
        </a>

        <!-- Flight Info Header -->
        <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl p-6 mb-8 shadow-2xl">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <img src="https://logo.clearbit.com/{{ airline_name.lower().replace(' ', '') }}.com" 
                         alt="{{ airline_name }}" 
                         class="w-16 h-16 rounded-xl bg-white p-2"
                         onerror="this.src='https://via.placeholder.com/64?text={{ flight.carrierCode }}'">
                    <div>
                        <h1 class="text-2xl font-bold text-white">{{ airline_name }}</h1>
                        <p class="text-slate-400">{{ flight.carrierCode }} Flight</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="flex items-center gap-3 text-white text-xl font-semibold">
                        <span>{{ flight.departure.iataCode }}</span>
                        <i class="fas fa-plane text-blue-400"></i>
                        <span>{{ flight.arrival.iataCode }}</span>
                    </div>
                    <p class="text-slate-400 mt-1">{{ flight.departure.city }} â†’ {{ flight.arrival.city }}</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Seat Map -->
            <div class="lg:col-span-2">
                <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl p-8 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-6">Select Your Seat</h2>

                    <!-- Legend -->
                    <div class="flex flex-wrap gap-6 mb-8 p-4 bg-slate-800/50 rounded-2xl">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-green-500 rounded-lg"></div>
                            <span class="text-slate-300 text-sm font-medium">Available</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-blue-500 rounded-lg shadow-lg shadow-blue-500/50"></div>
                            <span class="text-slate-300 text-sm font-medium">Selected</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-gray-600 rounded-lg opacity-50"></div>
                            <span class="text-slate-300 text-sm font-medium">Occupied</span>
                        </div>
                    </div>

                    <!-- Cockpit -->
                    <div class="text-center mb-8">
                        <div class="inline-block bg-gradient-to-b from-blue-600 to-blue-800 rounded-t-full px-20 py-4">
                            <i class="fas fa-plane text-white text-3xl"></i>
                        </div>
                    </div>

                    <!-- Seat Grid -->
                    <div class="space-y-3" id="seatGrid">
                        <!-- Rows will be generated by JavaScript -->
                    </div>

                    <!-- Emergency Exit -->
                    <div class="text-center my-8">
                        <div class="inline-block bg-red-500/20 border border-red-500/50 rounded-lg px-6 py-2">
                            <span class="text-red-400 text-sm font-semibold">
                                <i class="fas fa-door-open mr-2"></i>EMERGENCY EXIT
                            </span>
                        </div>
                    </div>

                    <div class="space-y-3" id="seatGridBack"></div>
                </div>
            </div>

            <!-- Booking Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl p-6 shadow-2xl sticky top-8">
                    <h3 class="text-xl font-bold text-white mb-6">Booking Summary</h3>
                    
                    <div class="space-y-4 mb-6">
                        <div>
                            <p class="text-slate-400 text-sm mb-1">Selected Seat</p>
                            <p id="selectedSeatDisplay" class="text-white text-2xl font-bold">-</p>
                        </div>
                        
                        <div class="border-t border-white/10 pt-4">
                            <p class="text-slate-400 text-sm mb-1">Departure</p>
                            <p class="text-white font-semibold">{{ flight.departure.at|format_date }}</p>
                            <p class="text-slate-300 text-sm">{{ flight.departure.at|format_datetime }}</p>
                        </div>

                        <div>
                            <p class="text-slate-400 text-sm mb-1">Arrival</p>
                            <p class="text-white font-semibold">{{ flight.arrival.at|format_date }}</p>
                            <p class="text-slate-300 text-sm">{{ flight.arrival.at|format_datetime }}</p>
                        </div>
                    </div>

                    <form method="post" action="{{ url_for('confirm') }}" id="seatForm">
                        <input type="hidden" name="seat_number" id="seatNumberInput" value="">
                        <button type="submit" 
                                id="confirmBtn"
                                disabled
                                class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-4 px-6 rounded-xl text-lg shadow-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
                            <i class="fas fa-check-circle mr-2"></i>
                            Proceed to Confirm
                        </button>
                    </form>

                    <p class="text-slate-400 text-xs text-center mt-4">
                        <i class="fas fa-info-circle mr-1"></i>
                        Seat selection is complimentary
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Seat configuration
        const rows = 25;
        const seatsPerRow = 6;
        const aislePosition = 3;
        let selectedSeat = null;

        // Generate random blocked seats (mock data)
        function generateBlockedSeats() {
            const blocked = new Set();
            const totalSeats = rows * seatsPerRow;
            const numBlocked = Math.floor(totalSeats * 0.3); // 30% occupied
            
            while (blocked.size < numBlocked) {
                const row = Math.floor(Math.random() * rows) + 1;
                const seatIndex = Math.floor(Math.random() * seatsPerRow);
                const letter = ['A', 'B', 'C', 'D', 'E', 'F'][seatIndex];
                blocked.add(`${row}${letter}`);
            }
            return Array.from(blocked);
        }

        const blockedSeats = generateBlockedSeats();

        // Generate seat grid
        function generateSeats() {
            const seatGrid = document.getElementById('seatGrid');
            const seatGridBack = document.getElementById('seatGridBack');
            const letters = ['A', 'B', 'C', 'D', 'E', 'F'];

            for (let row = 1; row <= rows; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'flex justify-center items-center gap-3';

                // Row number (left)
                const rowNumLeft = document.createElement('div');
                rowNumLeft.className = 'text-slate-500 font-semibold w-8 text-center text-sm';
                rowNumLeft.textContent = row;
                rowDiv.appendChild(rowNumLeft);

                // Seats
                for (let seatIndex = 0; seatIndex < seatsPerRow; seatIndex++) {
                    if (seatIndex === aislePosition) {
                        const aisle = document.createElement('div');
                        aisle.className = 'w-12';
                        rowDiv.appendChild(aisle);
                    }

                    const seatLetter = letters[seatIndex];
                    const seatNumber = `${row}${seatLetter}`;
                    const isBlocked = blockedSeats.includes(seatNumber);

                    const seat = document.createElement('div');
                    seat.className = `seat w-10 h-10 rounded-lg flex items-center justify-center text-white text-xs font-semibold ${
                        isBlocked ? 'blocked' : 'available'
                    }`;
                    seat.dataset.seat = seatNumber;
                    seat.innerHTML = isBlocked ? '<i class="fas fa-times"></i>' : seatLetter;

                    if (!isBlocked) {
                        seat.onclick = () => selectSeat(seatNumber, seat);
                    }

                    rowDiv.appendChild(seat);
                }

                // Row number (right)
                const rowNumRight = document.createElement('div');
                rowNumRight.className = 'text-slate-500 font-semibold w-8 text-center text-sm';
                rowNumRight.textContent = row;
                rowDiv.appendChild(rowNumRight);

                if (row <= 12) {
                    seatGrid.appendChild(rowDiv);
                } else {
                    seatGridBack.appendChild(rowDiv);
                }
            }
        }

        function selectSeat(seatNumber, seatElement) {
            // Deselect previous
            if (selectedSeat) {
                const prevSeat = document.querySelector(`[data-seat="${selectedSeat}"]`);
                if (prevSeat && !prevSeat.classList.contains('blocked')) {
                    prevSeat.classList.remove('selected');
                    prevSeat.classList.add('available');
                }
            }

            // Select new
            selectedSeat = seatNumber;
            seatElement.classList.remove('available');
            seatElement.classList.add('selected');

            // Update UI
            document.getElementById('selectedSeatDisplay').textContent = seatNumber;
            document.getElementById('seatNumberInput').value = seatNumber;
            document.getElementById('confirmBtn').disabled = false;
        }

        // Initialize
        generateSeats();
    </script>
</body>
</html>
